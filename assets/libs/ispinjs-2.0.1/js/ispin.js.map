{"version":3,"file":"ispin.js","sources":["../src/ispin.js"],"sourcesContent":["// @flow\n\ntype SpinDirection = (1 | -1);\ntype SpinOptions = {\n  wrapperClass: string,\n  buttonsClass: string,\n  step: number,\n  pageStep: number,\n  repeatInterval: number,\n  wrapOverflow: boolean,\n  parse: string => number,\n  format: number => string,\n  disabled: boolean,\n  max?: number,\n  min?: number,\n  onChange?: string => void,\n};\n\n\nexport default\nclass ISpin {\n  static DEFAULTS: $Shape<SpinOptions>;\n  el: HTMLInputElement;\n  options: SpinOptions;\n  _onKeyDown: (e: KeyboardEvent) => void;\n  _onMouseDown: (e: MouseEvent) => void;\n  _onMouseUp: (e: MouseEvent) => void;\n  _onMouseLeave: (e: MouseEvent) => void;\n  _onWheel: (e: WheelEvent) => void;\n  _wrapper: HTMLElement;\n  _buttons: {\n    inc: HTMLButtonElement,\n    dec: HTMLButtonElement\n  };\n  _spinTimer: IntervalID;\n\n  constructor (el: HTMLInputElement, opts: $Shape<SpinOptions>) {\n    this.el = el;\n    // $FlowFixMe temporary assignment\n    this.options = {};\n\n    this._onKeyDown = this._onKeyDown.bind(this);\n    this._onMouseDown = this._onMouseDown.bind(this);\n    this._onMouseUp = this._onMouseUp.bind(this);\n    this._onMouseLeave = this._onMouseLeave.bind(this);\n    this._onWheel = this._onWheel.bind(this);\n\n    this.build();\n    this.update(opts);\n  }\n\n  build () {\n    // wrap element\n    this._wrapper = document.createElement('div');\n    if (this.el.parentNode) this.el.parentNode.replaceChild(this._wrapper, this.el);\n    this._wrapper.appendChild(this.el);\n\n    // add buttons\n    this._buttons = {\n      inc: document.createElement('button'),\n      dec: document.createElement('button')\n    };\n\n    // listen to events\n    Object.keys(this._buttons).forEach(k => {\n      const b = this._buttons[k];\n      this._wrapper.appendChild(b);\n      b.setAttribute('type', 'button');\n      b.addEventListener('mousedown', this._onMouseDown);\n      b.addEventListener('mouseup', this._onMouseUp);\n      b.addEventListener('mouseleave', this._onMouseLeave);\n    });\n    this.el.addEventListener('keydown', this._onKeyDown);\n    this.el.addEventListener('wheel', this._onWheel);\n  }\n\n  update (opts: $Shape<SpinOptions>) {\n    opts = {\n      ...ISpin.DEFAULTS,\n      ...this.options,\n      ...opts\n    };\n\n    // update wrapper class\n    if (opts.wrapperClass !== this.options.wrapperClass) {\n      if (this.options.wrapperClass) this._wrapper.classList.remove(this.options.wrapperClass);\n      if (opts.wrapperClass) this._wrapper.classList.add(opts.wrapperClass);\n    }\n\n    if (opts.buttonsClass !== this.options.buttonsClass) {\n      if (this.options.buttonsClass) {\n        Object.keys(this._buttons).forEach(k => {\n          this._buttons[k].classList.remove(this.options.buttonsClass);\n          this._buttons[k].classList.remove(this.options.buttonsClass + '-' + k);\n        });\n      }\n      if (opts.buttonsClass) {\n        Object.keys(this._buttons).forEach(k => {\n          this._buttons[k].classList.add(opts.buttonsClass);\n          this._buttons[k].classList.add(opts.buttonsClass + '-' + k);\n        });\n      }\n    }\n\n    this.disabled = opts.disabled;\n\n    Object.assign(this.options, opts);\n  }\n\n  destroy () {\n    if (this._wrapper.parentNode) this._wrapper.parentNode.replaceChild(this.el, this._wrapper);\n    delete this.el;\n    delete this._wrapper;\n    delete this._buttons;\n  }\n\n  _onKeyDown (e: KeyboardEvent) {\n    switch (e.keyCode) {\n      case 38: // arrow up\n        e.preventDefault();\n        return this.spin(this.options.step);\n      case 40: // arrow down\n        e.preventDefault();\n        return this.spin(-this.options.step);\n      case 33: // page up\n        e.preventDefault();\n        return this.spin(this.options.pageStep);\n      case 34: // page down\n        e.preventDefault();\n        return this.spin(-this.options.pageStep);\n    }\n  }\n\n  _onMouseDown (e: MouseEvent) {\n    e.preventDefault();\n\n    const direction: SpinDirection = e.currentTarget === this._buttons.inc ? 1 : -1;\n    this.spin(direction * this.options.step);\n    this.el.focus();\n\n    this._startSpinning(direction);\n  }\n\n  _onMouseUp (e: MouseEvent) {\n    this._stopSpinning();\n  }\n\n  _onMouseLeave (e: MouseEvent) {\n    this._stopSpinning();\n  }\n\n  _startSpinning (direction: SpinDirection) {\n    this._stopSpinning();\n    this._spinTimer = setInterval(() => this.spin(direction * this.options.step), this.options.repeatInterval);\n  }\n\n  _stopSpinning () {\n    clearInterval(this._spinTimer);\n  }\n\n  _onWheel (e: WheelEvent) {\n    if (document.activeElement !== this.el) return;\n    e.preventDefault();\n\n    const direction: SpinDirection = (e.deltaY > 0 ? -1 : 1);\n    this.spin(direction * this.options.step);\n  }\n\n  get value (): number {\n    return this.options.parse(this.el.value) || 0;\n  }\n\n  set value (value: number) {\n    const strValue = this.options.format(this.options.parse(String(value)));\n    this.el.value = strValue;\n    if (this.options.onChange) this.options.onChange(strValue);\n  }\n\n  get disabled (): boolean {\n    return this._buttons.inc.disabled;\n  }\n\n  set disabled (disabled: boolean) {\n    if (this.disabled === disabled) return;\n\n    this._buttons.inc.disabled =\n    this._buttons.dec.disabled = disabled;\n  }\n\n  get precision (): number {\n    return Math.max(...[this.options.step, this.options.min]\n      .filter(v => v != null)\n      // $FlowFixMe already checked above\n      .map(precision));\n  }\n\n  adjustValue (value: number): number {\n    value = Number(value.toFixed(this.precision));\n\n    if (this.options.max != null && value > this.options.max) value = this.options.max;\n    if (this.options.min != null && value < this.options.min) value = this.options.min;\n\n    return value;\n  }\n\n  wrapValue (value: number): number {\n    if (this.options.wrapOverflow &&\n      this.options.max != null &&\n      this.options.min != null\n    ) {\n      if (value < this.options.min) value = this.options.max;\n      else if (value > this.options.max) value = this.options.min;\n    }\n    return value;\n  }\n\n  spin (step: number) {\n    this.value = this.adjustValue(this.wrapValue(this.value + step));\n  }\n}\nISpin.DEFAULTS = {\n  wrapperClass: 'ispin-wrapper',\n  buttonsClass: 'ispin-button',\n  step: 1,\n  pageStep: 10,\n  disabled: false,\n  repeatInterval: 200,\n  wrapOverflow: false,\n  parse: Number,\n  format: String\n};\n\nfunction precision (num: number) {\n  return (String(num).split('.')[1] || '').length;\n}\n"],"names":["ISpin","el","opts","options","_onKeyDown","bind","_onMouseDown","_onMouseUp","_onMouseLeave","_onWheel","build","update","_wrapper","document","createElement","parentNode","replaceChild","appendChild","_buttons","inc","dec","Object","keys","forEach","k","b","setAttribute","addEventListener","DEFAULTS","wrapperClass","classList","remove","add","buttonsClass","disabled","e","keyCode","preventDefault","spin","step","pageStep","direction","currentTarget","focus","_startSpinning","_stopSpinning","_spinTimer","setInterval","repeatInterval","clearInterval","activeElement","deltaY","value","Number","toFixed","precision","max","min","wrapOverflow","adjustValue","wrapValue","parse","strValue","format","String","onChange","Math","filter","v","map","num","split","length"],"mappings":"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"}