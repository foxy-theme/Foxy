{"version":3,"file":"ispin.min.js","sources":["../src/ispin.js"],"sourcesContent":["// @flow\n\ntype SpinDirection = (1 | -1);\ntype SpinOptions = {\n  wrapperClass: string,\n  buttonsClass: string,\n  step: number,\n  pageStep: number,\n  repeatInterval: number,\n  wrapOverflow: boolean,\n  parse: string => number,\n  format: number => string,\n  disabled: boolean,\n  max?: number,\n  min?: number,\n  onChange?: string => void,\n};\n\n\nexport default\nclass ISpin {\n  static DEFAULTS: $Shape<SpinOptions>;\n  el: HTMLInputElement;\n  options: SpinOptions;\n  _onKeyDown: (e: KeyboardEvent) => void;\n  _onMouseDown: (e: MouseEvent) => void;\n  _onMouseUp: (e: MouseEvent) => void;\n  _onMouseLeave: (e: MouseEvent) => void;\n  _onWheel: (e: WheelEvent) => void;\n  _wrapper: HTMLElement;\n  _buttons: {\n    inc: HTMLButtonElement,\n    dec: HTMLButtonElement\n  };\n  _spinTimer: IntervalID;\n\n  constructor (el: HTMLInputElement, opts: $Shape<SpinOptions>) {\n    this.el = el;\n    // $FlowFixMe temporary assignment\n    this.options = {};\n\n    this._onKeyDown = this._onKeyDown.bind(this);\n    this._onMouseDown = this._onMouseDown.bind(this);\n    this._onMouseUp = this._onMouseUp.bind(this);\n    this._onMouseLeave = this._onMouseLeave.bind(this);\n    this._onWheel = this._onWheel.bind(this);\n\n    this.build();\n    this.update(opts);\n  }\n\n  build () {\n    // wrap element\n    this._wrapper = document.createElement('div');\n    if (this.el.parentNode) this.el.parentNode.replaceChild(this._wrapper, this.el);\n    this._wrapper.appendChild(this.el);\n\n    // add buttons\n    this._buttons = {\n      inc: document.createElement('button'),\n      dec: document.createElement('button')\n    };\n\n    // listen to events\n    Object.keys(this._buttons).forEach(k => {\n      const b = this._buttons[k];\n      this._wrapper.appendChild(b);\n      b.setAttribute('type', 'button');\n      b.addEventListener('mousedown', this._onMouseDown);\n      b.addEventListener('mouseup', this._onMouseUp);\n      b.addEventListener('mouseleave', this._onMouseLeave);\n    });\n    this.el.addEventListener('keydown', this._onKeyDown);\n    this.el.addEventListener('wheel', this._onWheel);\n  }\n\n  update (opts: $Shape<SpinOptions>) {\n    opts = {\n      ...ISpin.DEFAULTS,\n      ...this.options,\n      ...opts\n    };\n\n    // update wrapper class\n    if (opts.wrapperClass !== this.options.wrapperClass) {\n      if (this.options.wrapperClass) this._wrapper.classList.remove(this.options.wrapperClass);\n      if (opts.wrapperClass) this._wrapper.classList.add(opts.wrapperClass);\n    }\n\n    if (opts.buttonsClass !== this.options.buttonsClass) {\n      if (this.options.buttonsClass) {\n        Object.keys(this._buttons).forEach(k => {\n          this._buttons[k].classList.remove(this.options.buttonsClass);\n          this._buttons[k].classList.remove(this.options.buttonsClass + '-' + k);\n        });\n      }\n      if (opts.buttonsClass) {\n        Object.keys(this._buttons).forEach(k => {\n          this._buttons[k].classList.add(opts.buttonsClass);\n          this._buttons[k].classList.add(opts.buttonsClass + '-' + k);\n        });\n      }\n    }\n\n    this.disabled = opts.disabled;\n\n    Object.assign(this.options, opts);\n  }\n\n  destroy () {\n    if (this._wrapper.parentNode) this._wrapper.parentNode.replaceChild(this.el, this._wrapper);\n    delete this.el;\n    delete this._wrapper;\n    delete this._buttons;\n  }\n\n  _onKeyDown (e: KeyboardEvent) {\n    switch (e.keyCode) {\n      case 38: // arrow up\n        e.preventDefault();\n        return this.spin(this.options.step);\n      case 40: // arrow down\n        e.preventDefault();\n        return this.spin(-this.options.step);\n      case 33: // page up\n        e.preventDefault();\n        return this.spin(this.options.pageStep);\n      case 34: // page down\n        e.preventDefault();\n        return this.spin(-this.options.pageStep);\n    }\n  }\n\n  _onMouseDown (e: MouseEvent) {\n    e.preventDefault();\n\n    const direction: SpinDirection = e.currentTarget === this._buttons.inc ? 1 : -1;\n    this.spin(direction * this.options.step);\n    this.el.focus();\n\n    this._startSpinning(direction);\n  }\n\n  _onMouseUp (e: MouseEvent) {\n    this._stopSpinning();\n  }\n\n  _onMouseLeave (e: MouseEvent) {\n    this._stopSpinning();\n  }\n\n  _startSpinning (direction: SpinDirection) {\n    this._stopSpinning();\n    this._spinTimer = setInterval(() => this.spin(direction * this.options.step), this.options.repeatInterval);\n  }\n\n  _stopSpinning () {\n    clearInterval(this._spinTimer);\n  }\n\n  _onWheel (e: WheelEvent) {\n    if (document.activeElement !== this.el) return;\n    e.preventDefault();\n\n    const direction: SpinDirection = (e.deltaY > 0 ? -1 : 1);\n    this.spin(direction * this.options.step);\n  }\n\n  get value (): number {\n    return this.options.parse(this.el.value) || 0;\n  }\n\n  set value (value: number) {\n    const strValue = this.options.format(this.options.parse(String(value)));\n    this.el.value = strValue;\n    if (this.options.onChange) this.options.onChange(strValue);\n  }\n\n  get disabled (): boolean {\n    return this._buttons.inc.disabled;\n  }\n\n  set disabled (disabled: boolean) {\n    if (this.disabled === disabled) return;\n\n    this._buttons.inc.disabled =\n    this._buttons.dec.disabled = disabled;\n  }\n\n  get precision (): number {\n    return Math.max(...[this.options.step, this.options.min]\n      .filter(v => v != null)\n      // $FlowFixMe already checked above\n      .map(precision));\n  }\n\n  adjustValue (value: number): number {\n    value = Number(value.toFixed(this.precision));\n\n    if (this.options.max != null && value > this.options.max) value = this.options.max;\n    if (this.options.min != null && value < this.options.min) value = this.options.min;\n\n    return value;\n  }\n\n  wrapValue (value: number): number {\n    if (this.options.wrapOverflow &&\n      this.options.max != null &&\n      this.options.min != null\n    ) {\n      if (value < this.options.min) value = this.options.max;\n      else if (value > this.options.max) value = this.options.min;\n    }\n    return value;\n  }\n\n  spin (step: number) {\n    this.value = this.adjustValue(this.wrapValue(this.value + step));\n  }\n}\nISpin.DEFAULTS = {\n  wrapperClass: 'ispin-wrapper',\n  buttonsClass: 'ispin-button',\n  step: 1,\n  pageStep: 10,\n  disabled: false,\n  repeatInterval: 200,\n  wrapOverflow: false,\n  parse: Number,\n  format: String\n};\n\nfunction precision (num: number) {\n  return (String(num).split('.')[1] || '').length;\n}\n"],"names":["ISpin","el","opts","options","_onKeyDown","this","bind","_onMouseDown","_onMouseUp","_onMouseLeave","_onWheel","build","update","_wrapper","document","createElement","parentNode","replaceChild","appendChild","_buttons","inc","dec","Object","keys","forEach","k","b","_this","setAttribute","addEventListener","DEFAULTS","wrapperClass","classList","remove","add","buttonsClass","_this2","disabled","e","keyCode","preventDefault","spin","step","pageStep","direction","currentTarget","focus","_startSpinning","_stopSpinning","_spinTimer","setInterval","_this3","repeatInterval","clearInterval","activeElement","deltaY","value","Number","toFixed","precision","max","min","wrapOverflow","adjustValue","wrapValue","parse","strValue","format","String","onChange","Math","filter","v","map","num","split","length"],"mappings":"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"}